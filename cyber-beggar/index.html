<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30s Everyday Chill</title>
    <style>
        /* --- 1. Base & Cyber-Beggar Aesthetic (Dark Mode) --- */
        body {
            background-color: #222; color: #f4f0ea;
            /* å¢åŠ äº†ä¸­æ–‡é»‘ä½“æ”¯æŒï¼Œè‹±æ–‡ä¿ç•™å¤å¤ Courier */
            font-family: 'Courier New', Courier, "PingFang SC", "Microsoft YaHei", "Heiti SC", sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; overflow-x: hidden;
            user-select: none;
        }
        h1 {
            /* ä½¿ç”¨ clamp åŠ¨æ€è°ƒæ•´å­—å·ï¼Œå¹¶è®¾ç½® white-space: nowrap é˜²æ­¢æ‰‹æœºç«¯æ¢è¡Œ */
            font-size: clamp(1.1rem, 4.5vw, 1.5rem); margin-bottom: 2rem; text-transform: uppercase;
            letter-spacing: 2px; text-align: center; padding: 0 10px; z-index: 5;
            white-space: nowrap;
        }

        /* --- æ–°å¢ï¼šè¯­è¨€åˆ‡æ¢æŒ‰é’® --- */
        #lang-toggle {
            position: absolute; top: 20px; right: 20px;
            background: transparent; border: 2px solid #f4f0ea; color: #f4f0ea;
            padding: 5px 10px; font-family: inherit; font-weight: bold; cursor: pointer;
            z-index: 1000; transition: all 0.2s; text-transform: uppercase;
        }
        #lang-toggle:hover { background: #f4f0ea; color: #111; }

        /* --- 2. THE WANDERING JAR BUDDY --- */
        #jar-buddy {
            position: fixed; 
            top: 20%; left: 10%; 
            width: 100px; height: 124px;
            z-index: 50; 
            pointer-events: auto; cursor: grab;
            touch-action: none; 
            transition: transform 0.2s ease; 
        }
        
        #jar-inner {
            position: relative; width: 100%; height: 100%;
            animation: float 3s ease-in-out infinite; 
        }

        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }

        /* --- æš–é‡‘è‰²æµå…‰ç»ç’ƒç‰¹æ•ˆ --- */
        @keyframes neonPulse {
            0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.4), inset 4px 4px 0 rgba(255, 255, 255, 0.5), inset -4px -4px 0 rgba(255, 140, 0, 0.4); }
            50% { box-shadow: 0 0 30px rgba(255, 165, 0, 0.8), inset 4px 4px 0 rgba(255, 255, 255, 0.7), inset -4px -4px 0 rgba(255, 69, 0, 0.6); }
            100% { box-shadow: 0 0 20px rgba(255, 140, 0, 0.5), inset 4px 4px 0 rgba(255, 255, 255, 0.6), inset -4px -4px 0 rgba(255, 215, 0, 0.5); }
        }

        /* ç“¶ç›– */
        .jar-lid {
            position: absolute; top: 0; left: 26px; width: 48px; height: 12px;
            background-color: #FFD700; border: 4px solid #111; z-index: 4;
            box-shadow: inset 4px 4px 0 #FFF6A3, inset -4px -4px 0 #DAA520; 
        }
        .jar-lid::after {
             content: ''; position: absolute; top: 4px; left: 16px;
             width: 16px; height: 4px; background-color: #111;
        }
        
        /* ç“¶é¢ˆ */
        .jar-neck {
            position: absolute; top: 16px; left: 34px; width: 32px; height: 16px;
            background-color: rgba(255, 215, 0, 0.15); border-left: 4px solid #111; border-right: 4px solid #111;
            z-index: 3;
            box-shadow: inset 4px 0 0 rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
        }
        .jar-neck::after {
            content: ''; position: absolute; bottom: -4px; left: 0; width: 100%; height: 4px;
            background-color: rgba(255, 215, 0, 0.15); z-index: 4;
        }
        
        /* ç“¶èº« */
        .jar-body {
            position: absolute; top: 32px; left: 10px; width: 80px; height: 72px;
            border: 4px solid #111; background-color: rgba(255, 215, 0, 0.15); 
            animation: neonPulse 3s infinite alternate ease-in-out; 
            backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            z-index: 2; overflow: hidden;
        }

        /* æš–è‰²ç³»æ•£å°„å…‰ç²’ */
        .light-particle {
            position: absolute; width: 4px; height: 4px; 
            border-radius: 0; z-index: 3;
            animation: floatUp 2s infinite linear; opacity: 0;
        }
        .light-particle:nth-child(1) { left: 20%; background-color: #FFD700; box-shadow: 0 0 6px #FFD700; animation-delay: 0s; animation-duration: 2.5s; }
        .light-particle:nth-child(2) { left: 50%; background-color: #FFA500; box-shadow: 0 0 6px #FFA500; animation-delay: 0.8s; animation-duration: 2s; }
        .light-particle:nth-child(3) { left: 80%; background-color: #FFD700; box-shadow: 0 0 6px #FFD700; animation-delay: 1.5s; animation-duration: 3s; }
        @keyframes floatUp {
            0% { transform: translateY(60px) scale(0.5); opacity: 0; }
            20% { opacity: 0.8; }
            80% { opacity: 0.8; }
            100% { transform: translateY(10px) scale(1); opacity: 0; }
        }
        
        /* --- çº¯æ–¹å— 8-BIT è¡¨æƒ… --- */
        .pixel-face {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            width: 44px; height: 28px; display: flex; flex-direction: column; align-items: center; z-index: 5;
        }
        .eyes { display: flex; justify-content: space-between; width: 100%; margin-bottom: 4px; }
        .eye { width: 8px; height: 8px; background-color: #111; }
        .mouth { width: 16px; height: 8px; background-color: transparent; border-bottom: 4px solid #111; border-left: 4px solid #111; border-right: 4px solid #111; }

        #jar-buddy.happy .eye { height: 4px; margin-top: 4px; background-color: transparent; border-top: 4px solid #111; border-left: 4px solid #111; border-right: 4px solid #111; }
        #jar-buddy.happy .mouth { width: 24px; height: 12px; background-color: #111; border: none; }
        
        #jar-buddy.excited .eye { width: 8px; height: 12px; }
        #jar-buddy.excited .mouth { width: 12px; height: 12px; background-color: #111; border: none; position: relative; overflow: hidden; margin-top: 2px; }
        #jar-buddy.excited .mouth::after { content: ''; position: absolute; bottom: 0; left: 2px; width: 8px; height: 4px; background-color: #FF6B6B; }
        
        #jar-buddy.boring .eye { height: 4px; margin-top: 4px; }
        #jar-buddy.boring .mouth { width: 12px; height: 4px; border: none; background-color: #111; }

        #jar-buddy.wicked .eye { width: 12px; height: 4px; margin-top: 4px; }
        #jar-buddy.wicked .eye:first-child { transform: rotate(20deg); }
        #jar-buddy.wicked .eye:last-child { transform: rotate(-20deg); }
        #jar-buddy.wicked .mouth { width: 24px; height: 4px; background-color: transparent; border-top: 4px solid #111; border-left: 4px solid #111; border-right: 4px solid #111; border-bottom: none; margin-top: 4px;}

        /* --- é‡‘å¸å†…å®¹ç‰© --- */
        .contents {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 35%;
            display: flex; justify-content: space-evenly; align-items: flex-end; padding: 4px 6px; box-sizing: border-box;
        }
        .pixel-coin {
            width: 16px; height: 12px; background-color: #FFD700; border: 4px solid #111; 
            box-shadow: inset -4px -4px 0 #DAA520; position: relative;
        }
        .pixel-coin:nth-child(1) { transform: rotate(-15deg); bottom: 2px; }
        .pixel-coin:nth-child(2) { transform: rotate(10deg); bottom: 6px; z-index: 2; }
        .pixel-coin:nth-child(3) { transform: rotate(25deg); bottom: 0px; }
        
        /* --- ä¿®æ­£åçš„æ‰‹è„šç»“æ„ --- */
        .limb { position: absolute; background-color: #111; z-index: 1; transition: z-index 0.2s ease; }
        .arm { width: 24px; height: 4px; top: 60px; } 
        .left-arm { left: -14px; transform-origin: right center; transform: rotate(25deg); animation: idleArmL 2.5s infinite ease-in-out; }
        .right-arm { right: -14px; transform-origin: left center; transform: rotate(-25deg); animation: idleArmR 2.5s infinite ease-in-out; }
        
        @keyframes idleArmL { 0%, 100% { transform: rotate(25deg); } 50% { transform: rotate(45deg); } }
        @keyframes idleArmR { 0%, 100% { transform: rotate(-25deg); } 50% { transform: rotate(-45deg); } }

        .leg { width: 4px; height: 16px; top: 112px; transform-origin: top center; }
        .leg::after { content: ''; position: absolute; bottom: 0; width: 12px; height: 4px; background-color: #111; } 
        .left-leg { left: 30px; transform: rotate(15deg); }
        .left-leg::after { left: -4px; }
        .right-leg { right: 30px; transform: rotate(-15deg); }
        .right-leg::after { right: -4px; transform: scaleX(-1); }

        /* --- åŠ¨æ€æµç•…è¡Œä¸ºåŠ¨ç”» --- */
        #jar-buddy.walking #jar-inner { animation: walkBob 0.3s infinite alternate ease-in-out; } 
        #jar-buddy.walking .left-leg { animation: walkLeft 0.4s infinite linear; }
        #jar-buddy.walking .right-leg { animation: walkRight 0.4s infinite linear; }
        
        @keyframes walkBob { 0% { transform: translateY(0px); } 100% { transform: translateY(-4px); } }
        @keyframes walkLeft { 0%, 100% { transform: rotate(15deg); } 50% { transform: rotate(-30deg); } }
        @keyframes walkRight { 0%, 100% { transform: rotate(-15deg); } 50% { transform: rotate(30deg); } }

        #jar-buddy.side-jumping #jar-inner { animation: sideJumpSpin 0.6s ease-in-out forwards; }
        @keyframes sideJumpSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #jar-buddy.bounce #jar-inner { animation: happyBounce 0.5s ease-out; }
        @keyframes happyBounce { 0%, 100% { transform: translateY(0); } 25%, 75% { transform: translateY(-24px); } 50% { transform: translateY(0); } }
        
        #jar-buddy.spin #jar-inner { animation: jackpotSpin 0.8s ease-in-out forwards; }
        @keyframes jackpotSpin { 0% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-40px) rotate(180deg); } 100% { transform: translateY(0) rotate(360deg); } }

        #jar-buddy.dragged { cursor: grabbing; }
        #jar-buddy.dragged #jar-inner { animation: dragWiggle 0.1s infinite alternate linear; }
        #jar-buddy.dragged .left-arm { transform: rotate(160deg); top: 30px; animation: none; z-index: 11;}
        #jar-buddy.dragged .right-arm { transform: rotate(-160deg); top: 30px; animation: none; z-index: 11;}
        #jar-buddy.dragged .left-leg { transform: rotate(5deg); animation: dragLegs 0.2s infinite alternate ease-in-out; }
        #jar-buddy.dragged .right-leg { transform: rotate(-5deg); animation: dragLegs 0.2s infinite alternate-reverse ease-in-out; }
        @keyframes dragWiggle { 0% { transform: rotate(-5deg); } 100% { transform: rotate(5deg); } }
        @keyframes dragLegs { 0% { transform: rotate(15deg); } 100% { transform: rotate(-15deg); } }

        /* --- å¾…æœºä¸äº’åŠ¨ --- */
        #jar-buddy.flipping #jar-inner { animation: backflip 1s ease-in-out; }
        @keyframes backflip { 0% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-40px) rotate(180deg); } 100% { transform: translateY(0) rotate(360deg); } }

        .zzz { position: absolute; top: -20px; right: -20px; color: #f4f0ea; font-family: inherit; font-weight: bold; font-size: 16px; opacity: 0; pointer-events: none; z-index: 10; }
        #jar-buddy.snoozing #jar-inner { animation: snoozeFloat 4s ease-in-out infinite; }
        #jar-buddy.snoozing .zzz { animation: zzzFloat 3s ease-in-out infinite; }
        @keyframes snoozeFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }
        @keyframes zzzFloat { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 1; } 100% { opacity: 0; transform: translateY(-24px); } }

        .play-coin { position: absolute; top: 15px; left: 42px; width: 12px; height: 12px; background-color: #FFD700; border: 4px solid #111; opacity: 0; z-index: 4; }
        #jar-buddy.playing .play-coin { animation: tossCoin 1s linear infinite; }
        #jar-buddy.playing .left-arm { transform: rotate(120deg); top: 35px; animation: tossArmL 1s ease-in-out infinite; }
        #jar-buddy.playing .right-arm { transform: rotate(-120deg); top: 35px; animation: tossArmR 1s ease-in-out infinite; }
        @keyframes tossCoin { 0%, 100% { opacity: 0; transform: translateY(0); } 10%, 90% { opacity: 1; } 50% { opacity: 1; transform: translateY(-32px); } }
        @keyframes tossArmL { 0%, 100% { transform: rotate(120deg); } 50% { transform: rotate(160deg); } }
        @keyframes tossArmR { 0%, 100% { transform: rotate(-120deg); } 50% { transform: rotate(-160deg); } }

        #jar-buddy.kissing .kiss-coin { opacity: 1; animation: kissCoinAnim 1s infinite alternate steps(2); }
        @keyframes kissCoinAnim { 0% { transform: translateY(0); } 100% { transform: translateY(-4px); } }

        /* --- æ–°å¢ï¼šè¾“å…¥æ¡†æ ·å¼ --- */
        #stress-input {
            background-color: #111; border: 4px solid #111; box-shadow: 4px 4px 0 #FFD700;
            color: #f4f0ea; padding: 12px 15px; font-family: inherit; font-size: 1rem; font-weight: bold;
            width: 100%; max-width: 300px; margin-bottom: 20px; outline: none; text-align: center;
            transition: all 0.2s; box-sizing: border-box;
        }
        #stress-input:focus { border-color: #FFD700; box-shadow: 4px 4px 0 #FF6B6B; }
        #stress-input::placeholder { color: #777; }

        /* --- æ–°å¢ï¼šSkip æŒ‰é’®æ ·å¼ --- */
        #skip-btn {
            display: none; 
            margin-top: 15px; background: #FF6B6B; border: 4px solid #111; color: #111;
            padding: 8px 20px; font-family: inherit; font-size: 1rem; font-weight: bold; cursor: pointer; text-transform: uppercase;
            animation: popIn 0.3s ease forwards; box-shadow: 4px 4px 0 #111;
            transition: all 0.1s ease;
        }
        #skip-btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0 #111; }

        /* --- 3. Interaction Components --- */
        #interaction-container { position: relative; width: 300px; height: 100px; display: flex; justify-content: center; z-index: 10; margin-bottom: 20px; }
        
        #coin {
            position: absolute; top: -60px; width: 36px; height: 36px; background-color: #FFD700;
            border: 4px solid #111; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 20px; box-shadow: inset -4px -4px 0 #DAA520, inset 4px 4px 0 #FFF6A3; 
            opacity: 0; pointer-events: none; z-index: 11; color: #111;
        }
        .dropping { animation: dropCoin 0.7s cubic-bezier(0.5, 0, 0.5, 1) forwards; }
        @keyframes dropCoin { 0% { opacity: 1; top: -60px; transform: rotate(0deg); } 80% { opacity: 1; top: 15px; transform: rotate(360deg); } 100% { opacity: 0; top: 25px; } }
        
        #blindbox {
            position: relative; background-color: #ffeb3b; border: 4px solid #111; box-shadow: 8px 8px 0px #111;
            padding: 20px 40px; font-size: 1.2rem; font-weight: bold; font-family: inherit; cursor: pointer;
            text-transform: uppercase; width: 100%; outline: none; -webkit-tap-highlight-color: transparent; color: #111;
            transition: all 0.1s ease;
        }
        #blindbox::before {
            content: ''; position: absolute; top: -4px; left: 50%; transform: translateX(-50%); width: 60px; height: 8px; background-color: #111;
        }
        #blindbox:active { transform: translate(2px, 2px); box-shadow: 6px 6px 0px #111; }
        .shaking { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-4px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-8px, 0, 0); } 40%, 60% { transform: translate3d(8px, 0, 0); } }

        /* å½©è›‹æŒ‰é’® */
        #easter-egg-btn {
            display: none; 
            margin-top: 20px; background: transparent; border: 2px dashed #f4f0ea; color: #f4f0ea;
            padding: 10px 20px; font-family: inherit; font-size: 1rem; font-weight: bold; cursor: pointer; text-transform: uppercase;
            animation: popIn 0.3s ease forwards;
            transition: all 0.3s ease;
        }
        #easter-egg-btn:hover { background: #f4f0ea; color: #111; border-style: solid; }
        
        #easter-egg-btn.fixed-bottom-right {
            position: fixed; bottom: 20px; right: 20px; margin-top: 0; z-index: 900;
            background: #f4f0ea; color: #111; border: 4px solid #111; box-shadow: 4px 4px 0 #FFD700;
        }

        #support-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-box {
            background: #222; border: 4px solid #FFD700; box-shadow: 8px 8px 0 #111;
            padding: 30px 40px; text-align: center; max-width: 80%; font-size: 1.2rem; line-height: 1.6;
            animation: popIn 0.3s ease forwards;
        }
        .close-modal {
            margin-top: 25px; background: #FFD700; border: 4px solid #111; color: #111; 
            padding: 8px 20px; font-weight: bold; font-family: inherit; cursor: pointer; text-transform: uppercase;
        }
        .close-modal:hover { background: #FFF6A3; }

        /* --- 4. The Reward Card --- */
        #reward-card {
            display: none; background-color: #333; border: 4px solid #111; box-shadow: 8px 8px 0px #111; padding: 25px;
            width: 85%; max-width: 400px; box-sizing: border-box; text-align: center; font-size: 1.1rem; line-height: 1.5; margin-top: 10px; 
            animation: popIn 0.3s ease forwards;
            position: relative; z-index: 100;
        }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        
        .poster-svg { width: 100%; height: auto; border: 4px solid #111; margin-bottom: 15px; }
        
        #reset-btn {
            margin-top: 20px; background: transparent; border: 4px solid #f4f0ea; color: #f4f0ea;
            padding: 8px 20px; font-family: inherit; font-weight: bold; cursor: pointer; text-transform: uppercase;
        }
        #reset-btn:hover { background: #f4f0ea; color: #111; }

        /* --- 5. FIXED STARS CSS --- */
        .dynamic-star {
            position: fixed; width: 12px; height: 12px; z-index: 9999; 
            pointer-events: none; opacity: 1; border: 4px solid #111; 
        }
        .dynamic-star.burst { animation: starBurst 1s ease-out forwards; }
        @keyframes starBurst {
            0% { transform: translate(0,0) rotate(0deg) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) rotate(360deg) scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body>

    <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
    <button id="lang-toggle">ä¸­æ–‡</button>

    <h1 id="site-title">[ ğŸ•¹ï¸ Insert Coin for 30s Chill â˜• ]</h1>

    <!-- The 8-Bit Coded Avatar -->
    <div id="jar-buddy">
        <div id="jar-inner">
            <div class="zzz">Zzz...</div>
            <div class="play-coin"></div>
            
            <div class="jar-lid"></div>
            <div class="jar-neck"></div> 
            <div class="jar-body">
                <!-- ç“¶å­å†…éƒ¨æ•£å‘çš„æš–è‰²å…‰ç²’ -->
                <div class="light-particle"></div>
                <div class="light-particle"></div>
                <div class="light-particle"></div>

                <div class="pixel-face">
                    <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                    <div class="mouth"></div>
                    <div class="kiss-coin"></div>
                </div>
                <div class="contents">
                    <div class="pixel-coin"></div>
                    <div class="pixel-coin"></div>
                    <div class="pixel-coin"></div>
                </div>
            </div>
            
            <div class="limb arm left-arm"></div>
            <div class="limb arm right-arm"></div>
            <div class="limb leg left-leg"></div>
            <div class="limb leg right-leg"></div>
        </div>
    </div>

    <!-- The Interaction -->
    <div id="interaction-wrapper" style="display: flex; flex-direction: column; align-items: center; z-index: 10;">
        <input type="text" id="stress-input" placeholder="What's on your mind? (Optional)">
        <div id="interaction-container">
            <div id="coin">$</div>
            <button id="blindbox">ğŸ INSERT COIN ğŸ</button>
        </div>
        <!-- å¼¹å‡ºçš„è·³è¿‡æŒ‰é’® -->
        <button id="skip-btn">I want it now!</button>
    </div>

    <!-- The Reward Card -->
    <div id="reward-card">
        <div id="reward-content"></div>
        <button id="reset-btn">Toss another?</button>
    </div>

    <!-- éšè—å½©è›‹æŒ‰é’® -->
    <button id="easter-egg-btn">find it interesting?</button>

    <!-- å½©è›‹æ”¯æŒå¼¹çª— -->
    <div id="support-modal">
        <div class="modal-box">
            <div id="modal-text">âœ¨ xoxo! please insert a real coin for me >u< âœ¨</div>
            <br>
            <div style="font-size: 0.9rem; color: #FFD700;">yishuangguo@qq.com</div>
            <br>
            <button class="close-modal" id="modal-close-btn">Close</button>
        </div>
    </div>

    <script>
        // --- 1. å¤šè¯­è¨€æ•°æ®é…ç½® ---
        const langData = {
            en: {
                title: "[ ğŸ•¹ï¸ Insert Coin for 30s Chill â˜• ]",
                btnInsert: "ğŸ INSERT COIN ğŸ",
                btnReset: "Toss another?",
                btnEaster: "find it interesting?",
                btnSkip: "I want it now!",
                modalMsg: "âœ¨ xoxo! please insert a real coin for me >u< âœ¨",
                modalClose: "Close",
                jackpotTitle: "<b>âœ¨ JACKPOT BONUS! âœ¨</b><br>You got a special buddy poster.<br>",
                jackpotSub: "<small>Take a 30s visual break.</small>",
                inputPlaceholder: "What's on your mind? (Optional)",
                oraclePrefix: "âœ¨ <b>Oracle Says:</b> ",
                consulting: "âœ¨ CONSULTING ORACLE... âœ¨",
                rewards: [
                    "ğŸ§˜ <b>30s Chill:</b> Stare at the wall behind your monitor and blink manually 10 times. Go.",
                    "ğŸ’§ <b>Hydration Check:</b> Take three sips of whatever beverage is closest to you.",
                    "ğŸŒ¬ï¸ <b>Breathe:</b> Inhale for 4 seconds. Hold for 4. Exhale for 4. Hold for 4.",
                    "ğŸ‘€ <b>Visual Diet:</b> Find one example of good visual hierarchy in your room right now.",
                    "ğŸ¨ <b>Daily Hex:</b> #FF7F50. Coral. Energetic but soft. Keep it handy.",
                    "ğŸŒ‰ <b>Structure Appreciation:</b> Look at a corner of your ceiling. Nice 90-degree angle.",
                    "ğŸ² <b>Dinner Dice:</b> Breakfast for Dinner. Eggs, toast, maybe a pancake.",
                    "ğŸ”® <b>The 8-Ball Says:</b> Close that shopping tab. Wait 24 hours.",
                    "ğŸ«‚ <b>High Five:</b> Give yourself a literal high-five right now. Do it.",
                    "ğŸ¥  <b>Anti-Fortune:</b> Your posture is currently mediocre. Sit up straight.",
                    "ğŸª™ <b>Cyber-Junk:</b> You found a pristine, mint-condition ASCII frog: (o_o) ",
                    "ğŸŸ <b>Slacker Drill:</b> Quickly press `Alt + Tab` once to maintain your flawless screen-switching muscle memory.",
                    "âŒ¨ï¸ <b>Fake Hustle:</b> Click randomly 10 times on this page to simulate intense productivity.",
                    "ğŸ’¼ <b>Anti-Hustle:</b> Slide down your chair by 5 cm right now. Congratulations on achieving peak posture.",
                    "ğŸ”® <b>Cyber Fortune:</b> Algorithms predict: You should drink milk tea today, avoid fixing last week's bugs.",
                    "ğŸ“¡ <b>Cosmic Signal:</b> Message received: 'Take it easy, the Earth will be destroyed eventually anyway.'",
                    "ğŸ”‹ <b>Low Battery:</b> You're below 20%. Pick up the nearest snack for immediate physical recharging.",
                    "ğŸª <b>Black Mirror:</b> Look at your reflection on the black screen. Who's that handsome/gorgeous soul drained by work? Oh, it's you.",
                    "ğŸ’¨ <b>Air Sommelier:</b> Take a deep breath. Savor the CO2 concentration around you. Now sigh heavily."
                ]
            },
            zh: {
                title: "[ ğŸ•¹ï¸ æŠ•å¸è·å–30ç§’æ”¾æ¾ â˜• ]",
                btnInsert: "ğŸ æŠ•å¸ ğŸ",
                btnReset: "å†æ¥ä¸€æ¬¡ï¼Ÿ",
                btnEaster: "è§‰å¾—æœ‰è¶£å—ï¼Ÿ",
                btnSkip: "æˆ‘ç°åœ¨å°±è¦ï¼",
                modalMsg: "âœ¨ xoxo! è¯·ç»™æˆ‘æŠ•ä¸ªçœŸæ­£çš„ç¡¬å¸å§ >u< âœ¨",
                modalClose: "å…³é—­",
                jackpotTitle: "<b>âœ¨ ç»ˆæå¤§å¥–ï¼ âœ¨</b><br>ä½ è·å¾—äº†ä¸€å¼ ä¸“å±å°ç½å¤´æµ·æŠ¥ã€‚<br>",
                jackpotSub: "<small>äº«å—30ç§’çš„è§†è§‰æ”¾æ¾å§ã€‚</small>",
                inputPlaceholder: "æœ‰ä»€ä¹ˆçƒ¦å¿ƒäº‹ï¼Ÿ(é€‰å¡«)",
                oraclePrefix: "âœ¨ <b>èµ›åšç¥è°•ï¼š</b> ",
                consulting: "âœ¨ ç¥æ˜ç®—å‘½ä¸­... âœ¨",
                rewards: [
                    "ğŸ§˜ <b>30ç§’æ”¾æ¾ï¼š</b>ç›¯ç€æ˜¾ç¤ºå™¨åé¢çš„å¢™ï¼Œæ‰‹åŠ¨çœ¨çœ¼10æ¬¡ã€‚å¼€å§‹ã€‚",
                    "ğŸ’§ <b>è¡¥å……æ°´åˆ†ï¼š</b>å–ä¸‰å£ç¦»ä½ æœ€è¿‘çš„é¥®æ–™ã€‚",
                    "ğŸŒ¬ï¸ <b>æ·±å‘¼å¸ï¼š</b>å¸æ°”4ç§’ã€‚æ†‹æ°”4ç§’ã€‚å‘¼æ°”4ç§’ã€‚æ†‹æ°”4ç§’ã€‚",
                    "ğŸ‘€ <b>è§†è§‰è°ƒå‰‚ï¼š</b>ç°åœ¨åœ¨ä½ çš„æˆ¿é—´é‡Œæ‰¾å‡ºä¸€ä¸ªè§†è§‰å±‚çº§ä¼˜ç§€çš„ä¾‹å­ã€‚",
                    "ğŸ¨ <b>ä»Šæ—¥è‰²å½©ï¼š</b>#FF7F50ã€‚çŠç‘šè‰²ã€‚å……æ»¡æ´»åŠ›åˆæŸ”å’Œã€‚æ”¶å¥½å®ƒã€‚",
                    "ğŸŒ‰ <b>ç»“æ„æ¬£èµï¼š</b>çœ‹çœ‹ä½ å¤©èŠ±æ¿çš„ä¸€ä¸ªè§’è½ã€‚å¤šå®Œç¾çš„90åº¦ç›´è§’ã€‚",
                    "ğŸ² <b>æ™šé¤éª°å­ï¼š</b>æ™šé¤åƒæ—©é¤ã€‚é¸¡è›‹ï¼Œåå¸ï¼Œä¹Ÿè®¸å†æ¥ä¸ªç…é¥¼ã€‚",
                    "ğŸ”® <b>ç¥å¥‡å…«å·çƒï¼š</b>å…³æ‰é‚£ä¸ªè´­ç‰©æ ‡ç­¾é¡µã€‚ç­‰24å°æ—¶å†è¯´ã€‚",
                    "ğŸ«‚ <b>å‡»æŒï¼š</b>ç°åœ¨ç»™è‡ªå·±ä¸€ä¸ªå­—é¢æ„ä¹‰ä¸Šçš„å‡»æŒã€‚å°±ç°åœ¨ã€‚",
                    "ğŸ¥  <b>åå¿ƒçµé¸¡æ±¤ï¼š</b>ä½ ç°åœ¨çš„åå§¿å¾ˆä¸€èˆ¬ã€‚åç›´äº†ã€‚",
                    "ğŸª™ <b>èµ›åšç ´çƒ‚ï¼š</b>ä½ æ‰¾åˆ°äº†ä¸€åªå®Œå¥½æ— æŸçš„ASCIIé’è›™: (o_o) ",
                    "ğŸŸ <b>æ‘¸é±¼æ¼”ç»ƒï¼š</b>è¿…é€ŸæŒ‰ä¸‹ `Alt + Tab`ï¼ˆæˆ–åˆ‡å±ï¼‰ä¸€æ¬¡ï¼Œä¿æŒä½ æµç•…çš„åˆ‡å±è‚Œè‚‰è®°å¿†ã€‚",
                    "âŒ¨ï¸ <b>æ— æ•ˆå¿™ç¢Œï¼š</b>è¯·åœ¨è¿™ä¸ªé¡µé¢éšä¾¿ä¹±ç‚¹ 10 æ¬¡é¼ æ ‡ï¼Œå‡è£…ä½ æ­£åœ¨è¿›è¡Œæ¿€çƒˆçš„å·¥ä½œè¾“å‡ºã€‚",
                    "ğŸ’¼ <b>åå†…å·å®£å‘Šï¼š</b>ç°åœ¨ï¼Œç«‹åˆ»ï¼ŒæŠŠèº«ä½“å¾€ä¸‹å‡ºæºœ 5 å˜ç±³ã€‚æ­å–œä½ è·å¾—äº†æœ¬å¹´åº¦æœ€ä½³åå§¿ã€‚",
                    "ğŸ”® <b>èµ›åšç®—å‘½ï¼š</b>ç»è¿‡ä¸¥å¯†çš„ç®—åŠ›æ¨æ¼”ï¼Œä½ ä»Šå¤©å®œå–å¥¶èŒ¶ï¼Œå¿Œä¿®å¤ä¸Šå‘¨çš„ BUGã€‚",
                    "ğŸ“¡ <b>å®‡å®™ä¿¡å·ï¼š</b>æ¥æ”¶åˆ°ä¸€æ¡å¤–æ˜Ÿä¿¡å·ï¼šâ€œåˆ«å¤ªæ‹¼äº†ï¼Œåæ­£åœ°çƒè¿Ÿæ—©è¦æ¯ç­çš„ã€‚â€",
                    "ğŸ”‹ <b>èƒ½é‡è€—å°½ï¼š</b>ä½ çš„ç”µé‡å·²ä¸è¶³ 20%ï¼Œè¯·é©¬ä¸Šæ‹¿èµ·æ—è¾¹çš„é›¶é£Ÿè¿›è¡Œç‰©ç†å……ç”µã€‚",
                    "ğŸª <b>é­”é•œé­”é•œï¼š</b>çœ‹çœ‹é»‘å±çš„åå…‰é‡Œï¼Œé‚£ä¸ªå› ä¸ºå·¥ä½œ/å­¦ä¹ è€Œé€æ¸å¤±å»çµé­‚çš„å¸…å“¥/ç¾å¥³æ˜¯è°ï¼Ÿå“¦ï¼Œæ˜¯ä½ ã€‚",
                    "ğŸ’¨ <b>ç©ºæ°”å“é‰´ï¼š</b>æ·±å¸ä¸€å£æ°”ï¼Œç»†ç»†å“å‘³ä¸€ä¸‹ä½ å‘¨å›´äºŒæ°§åŒ–ç¢³çš„æµ“åº¦ã€‚ç„¶åç‹ ç‹ åœ°å¹å‡ºæ¥ã€‚"
                ]
            }
        };

        const palettes = [
            ['#FFD700', '#FF6B6B', '#4ECDC4', '#1A535C'], ['#E0C097', '#B85C38', '#5C3D2E', '#2D2424'], 
            ['#A8E6CF', '#DCEDC1', '#FFD3B6', '#FFAAA5'], ['#111111', '#333333', '#555555', '#FFD700']  
        ];

        // --- 2. ELEMENTS ---
        const blindbox = document.getElementById('blindbox');
        const coin = document.getElementById('coin');
        const rewardCard = document.getElementById('reward-card');
        const rewardContent = document.getElementById('reward-content');
        const resetBtn = document.getElementById('reset-btn');
        const container = document.getElementById('interaction-container');
        const wrapper = document.getElementById('interaction-wrapper');
        const stressInput = document.getElementById('stress-input');
        const jarBuddy = document.getElementById('jar-buddy');
        const easterEggBtn = document.getElementById('easter-egg-btn');
        const supportModal = document.getElementById('support-modal');
        const closeModalBtn = document.getElementById('modal-close-btn');
        const langToggleBtn = document.getElementById('lang-toggle');
        const skipBtn = document.getElementById('skip-btn');
        
        let lastRewardIndex = -1; 
        let coinCount = 0; 
        let currentLang = 'en';
        let isPosterShowing = false;
        let currentPosterSVG = '';

        // --- Gemini API è®¾å®š ---
        const apiKey = "";

        async function fetchGeminiWithRetry(prompt, retries = 5) {
            const delays = [1000, 2000, 4000, 8000, 16000];
            const systemInstruction = "You are a sassy, chill 8-bit cyber-beggar jar. Provide a short, quirky 30-second relaxation task. Keep it under 3 sentences. Use emojis.";
            
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: systemInstruction }] }
                        })
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (error) {
                    if (i === retries - 1) return null;
                    await new Promise(res => setTimeout(res, delays[i]));
                }
            }
        }

        // --- è¯­è¨€åˆ‡æ¢é€»è¾‘ ---
        function updateLangUI() {
            const data = langData[currentLang];
            document.getElementById('site-title').innerText = data.title;
            blindbox.innerText = data.btnInsert;
            resetBtn.innerText = data.btnReset;
            easterEggBtn.innerText = data.btnEaster;
            document.getElementById('modal-text').innerText = data.modalMsg;
            closeModalBtn.innerText = data.modalClose;
            stressInput.placeholder = data.inputPlaceholder;
            skipBtn.innerText = data.btnSkip;

            // åŠ¨æ€æ›´æ–°è¯­è¨€åˆ‡æ¢æŒ‰é’®æ˜¾ç¤ºçš„æ–‡å­—
            langToggleBtn.innerText = currentLang === 'en' ? 'ä¸­æ–‡' : 'EN';

            // å¦‚æœå½“å‰æ­£å¼€ç€ç›²ç›’ï¼Œç«‹åˆ»æ— ç¼æ›¿æ¢æ–‡æ¡ˆ
            if (rewardCard.style.display === 'block') {
                if (isPosterShowing) {
                    rewardContent.innerHTML = data.jackpotTitle + currentPosterSVG + data.jackpotSub;
                } else if (lastRewardIndex !== -1) {
                    rewardContent.innerHTML = data.rewards[lastRewardIndex];
                }
            }
        }

        langToggleBtn.addEventListener('click', () => {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            updateLangUI();
        });

        // --- 3. WANDERING PET & DRAG LOGIC ---
        let jarX = window.innerWidth / 2 - 150;
        let jarY = 50;
        let targetX = jarX;
        let targetY = jarY;
        let jumpStartX = 0, jumpStartY = 0, jumpStartTime = 0; 
        let petState = 'idle'; 
        let petSpeed = 1.5;
        let isHovered = false; 

        let isDragging = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        // ç»‘å®šæ‹–æ‹½äº‹ä»¶ (æ”¯æŒé¼ æ ‡ + è§¦æ‘¸)
        jarBuddy.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', endDrag);

        jarBuddy.addEventListener('touchstart', startDrag, {passive: false});
        document.addEventListener('touchmove', drag, {passive: false});
        document.addEventListener('touchend', endDrag);

        function startDrag(e) {
            if (petState === 'running_to_box' || petState === 'jumping_aside' || petState === 'busy') return;
            isDragging = true;
            petState = 'dragged';
            jarBuddy.className = 'dragged excited'; 
            
            // å…¼å®¹é¼ æ ‡å’Œè§¦æ‘¸çš„åæ ‡è·å–
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

            const rect = jarBuddy.getBoundingClientRect();
            dragOffsetX = clientX - rect.left;
            dragOffsetY = clientY - rect.top;
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault(); // é˜»æ­¢æ‰‹æœºç«¯çš„é»˜è®¤å±å¹•æ»šåŠ¨
            
            // å…¼å®¹é¼ æ ‡å’Œè§¦æ‘¸çš„åæ ‡è·å–
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;

            jarX = clientX - dragOffsetX;
            jarY = clientY - dragOffsetY;
        }

        function endDrag() {
            if (!isDragging) return;
            isDragging = false;
            petState = 'idle';
            jarBuddy.className = '';
            targetX = jarX; targetY = jarY; 
            pickNewTarget();
        }

        jarBuddy.addEventListener('mouseenter', () => {
            if (petState === 'running_to_box' || petState === 'jumping_aside' || petState === 'busy' || petState === 'dragged') return;
            isHovered = true;
            jarBuddy.className = 'begging excited'; 
        });

        jarBuddy.addEventListener('mouseleave', () => {
            if (petState === 'running_to_box' || petState === 'jumping_aside' || petState === 'busy' || petState === 'dragged') return;
            isHovered = false;
            jarBuddy.className = '';
            if (petState === 'walking') jarBuddy.classList.add('walking');
            else if (petState === 'snoozing') jarBuddy.className = 'snoozing boring';
            else if (petState === 'playing') jarBuddy.className = 'playing happy';
            else if (petState === 'flipping') jarBuddy.className = 'flipping excited';
            else if (petState === 'wicked') jarBuddy.className = 'wicked';
            else if (petState === 'kissing') jarBuddy.className = 'kissing';
        });

        function pickNewTarget() {
            if (petState !== 'idle' && petState !== 'walking') return;
            targetX = Math.random() * (window.innerWidth - 120) + 10;
            targetY = Math.random() * (window.innerHeight - 150) + 10;
            petState = 'walking';
            jarBuddy.className = 'walking'; 
            jarBuddy.style.transform = targetX < jarX ? 'scaleX(-1)' : 'scaleX(1)';
        }

        function updatePet() {
            if (petState === 'dragged') {
                jarBuddy.style.left = jarX + 'px';
                jarBuddy.style.top = jarY + 'px';
                requestAnimationFrame(updatePet);
                return;
            }

            if (petState === 'jumping_aside') {
                const p = (Date.now() - jumpStartTime) / 600; 
                if (p < 1) {
                    jarX = jumpStartX + (targetX - jumpStartX) * p;
                    jarY = jumpStartY + (targetY - jumpStartY) * p - Math.sin(p * Math.PI) * 100;
                } else {
                    jarX = targetX;
                    jarY = targetY;
                }
            } 
            else if (petState === 'walking' || petState === 'running_to_box') {
                if (isHovered && petState !== 'running_to_box') {
                    requestAnimationFrame(updatePet);
                    return; 
                }

                const dx = targetX - jarX;
                const dy = targetY - jarY;
                const dist = Math.sqrt(dx*dx + dy*dy);
                
                if (dist < 10) { 
                    if (petState === 'running_to_box') {
                        petState = 'busy'; 
                        jarBuddy.className = 'anticipate excited'; 
                        startCoinDropSequence();
                    } else {
                        jarBuddy.classList.remove('walking');
                        const r = Math.random();
                        if (r < 0.15) { petState = 'snoozing'; if (!isHovered) jarBuddy.className = 'snoozing boring'; } 
                        else if (r < 0.3) { petState = 'playing'; if (!isHovered) jarBuddy.className = 'playing happy'; } 
                        else if (r < 0.45) { petState = 'flipping'; if (!isHovered) jarBuddy.className = 'flipping excited'; } 
                        else if (r < 0.6) { petState = 'wicked'; if (!isHovered) jarBuddy.className = 'wicked'; } 
                        else if (r < 0.8) { petState = 'kissing'; if (!isHovered) jarBuddy.className = 'kissing'; } 
                        else { petState = 'idle'; if (!isHovered) jarBuddy.className = ''; }
                        
                        setTimeout(() => {
                            if (petState !== 'running_to_box' && petState !== 'jumping_aside' && petState !== 'busy' && petState !== 'dragged') pickNewTarget();
                        }, 3000 + Math.random() * 4000); 
                    }
                } else {
                    jarX += (dx / dist) * petSpeed;
                    jarY += (dy / dist) * petSpeed;
                }
            }
            jarBuddy.style.left = jarX + 'px';
            jarBuddy.style.top = jarY + 'px';
            requestAnimationFrame(updatePet);
        }

        setTimeout(pickNewTarget, 1000);
        updatePet();

        // --- 4. HELPERS ---
        function playPopSound() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator(); const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode); gainNode.connect(audioCtx.destination);
            oscillator.type = 'square'; 
            oscillator.frequency.setValueAtTime(300, audioCtx.currentTime); 
            oscillator.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1); 
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); 
            oscillator.start(audioCtx.currentTime); oscillator.stop(audioCtx.currentTime + 0.1);
        }

        function createStarsBurst() {
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const colors = ['#FFD700', '#FFA500', '#FF8C00']; 

            for(let i=0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'dynamic-star';
                star.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                star.style.left = centerX + 'px';
                star.style.top = centerY + 'px';
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 150 + Math.random() * 200; 
                star.style.setProperty('--dx', (Math.cos(angle) * distance) + 'px');
                star.style.setProperty('--dy', (Math.sin(angle) * distance) + 'px');
                
                document.body.appendChild(star);
                requestAnimationFrame(() => star.classList.add('burst'));
                setTimeout(() => star.remove(), 1000);
            }
        }

        // --- æ‹†åˆ†å‡ºæ¥çš„æµ·æŠ¥ SVG ç»˜åˆ¶å‡½æ•° ---
        function generatePosterSVG() {
            const palette = palettes[Math.floor(Math.random() * palettes.length)];
            const bg = palette[0]; const ac1 = palette[1]; const ac2 = palette[2]; const ac3 = palette[3];
            
            const buddyIllustration = `
                <rect x="15" y="15" width="20" height="20" fill="${ac1}" opacity="0.6"/>
                <rect x="65" y="65" width="25" height="15" fill="${ac2}" opacity="0.6"/>
                <rect x="70" y="20" width="10" height="10" fill="${ac3}" opacity="0.8"/>
                <rect x="10" y="70" width="15" height="15" fill="${ac1}" opacity="0.8"/>
                
                <g transform="translate(30, 25)">
                    <path d="M 20 -10 L 22 -15 L 24 -10 L 29 -8 L 24 -6 L 22 -1 L 20 -6 L 15 -8 Z" fill="#FFD700"/>
                    <rect x="8" y="0" width="24" height="6" fill="#FFD700" stroke="#111" stroke-width="2"/>
                    <rect x="14" y="2" width="8" height="2" fill="#111" />
                    <rect x="12" y="8" width="16" height="8" fill="rgba(255,215,0,0.5)" stroke="#111" stroke-width="2"/>
                    <rect x="0" y="16" width="40" height="36" fill="rgba(255,215,0,0.5)" stroke="#111" stroke-width="2"/>
                    <rect x="5" y="42" width="10" height="6" fill="#FFD700" stroke="#111" stroke-width="2"/>
                    <rect x="15" y="44" width="10" height="6" fill="#FFD700" stroke="#111" stroke-width="2"/>
                    <rect x="25" y="40" width="10" height="6" fill="#FFD700" stroke="#111" stroke-width="2"/>
                    <path d="M 12 28 Q 14 26 16 28" fill="none" stroke="#111" stroke-width="2"/>
                    <path d="M 24 28 Q 26 26 28 28" fill="none" stroke="#111" stroke-width="2"/>
                    <rect x="14" y="32" width="12" height="6" fill="#111"/>
                    <rect x="16" y="34" width="8" height="4" fill="#FF6B6B"/>
                    <path d="M 0 30 L -8 20" stroke="#111" stroke-width="2"/>
                    <path d="M 40 30 L 48 20" stroke="#111" stroke-width="2"/>
                    <path d="M 10 52 L 10 60 L 6 60" stroke="#111" stroke-width="2" fill="none"/>
                    <path d="M 30 52 L 30 60 L 34 60" stroke="#111" stroke-width="2" fill="none"/>
                </g>
            `;

            return `<svg class="poster-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="background-color: ${bg}22">${buddyIllustration}</svg>`;
        }

        // --- 5. MAIN INTERACTION ---
        blindbox.addEventListener('click', () => {
            blindbox.style.pointerEvents = 'none'; 
            
            const boxRect = blindbox.getBoundingClientRect();
            targetX = boxRect.left - 20; 
            targetY = boxRect.top - 50; 
            
            jarBuddy.style.transform = targetX < jarX ? 'scaleX(-1)' : 'scaleX(1)';
            
            petSpeed = 8; 
            petState = 'running_to_box';
            jarBuddy.className = 'walking excited'; 
        });

        async function startCoinDropSequence() {
            const data = langData[currentLang];
            blindbox.innerText = data.consulting;
            skipBtn.style.display = 'none';

            // è®¾ç½® 5 ç§’ç­‰å¾…è¶…æ—¶è·³è¿‡é€»è¾‘
            let isSkipped = false;
            const skipPromise = new Promise(resolve => {
                skipBtn.onclick = () => {
                    isSkipped = true;
                    skipBtn.style.display = 'none';
                    resolve(null); // è¿”å›ç©ºå€¼è§¦å‘æœ¬åœ°å›é€€
                };
            });

            const timeoutId = setTimeout(() => {
                if (!isSkipped) {
                    skipBtn.style.display = 'block';
                }
            }, 5000);

            // å‘ Gemini API è¯·æ±‚ä¸ªæ€§åŒ–çš„æ”¾æ¾å»ºè®®
            const stressText = stressInput.value.trim();
            let finalPrompt = "";
            
            if (stressText) {
                // å¦‚æœç”¨æˆ·æœ‰è¾“å…¥ï¼Œå¼ºåˆ¶è¦æ±‚æ¨¡å‹ä½¿ç”¨ä¸è¾“å…¥å†…å®¹ç›¸åŒçš„è¯­è¨€è¿›è¡Œå›å¤
                finalPrompt = `The user is stressed about: "${stressText}". Give them a personalized, quirky 30-second relaxation task based on this. IMPORTANT: You MUST reply in the EXACT SAME LANGUAGE as the user's input. (e.g., if they input Chinese, reply in Chinese; if English, reply in English).`;
            } else {
                // å¦‚æœæ²¡æœ‰è¾“å…¥ï¼Œæ ¹æ®å½“å‰ç½‘é¡µUIè¯­è¨€ç”Ÿæˆéšæœºä»»åŠ¡
                const langPrompt = currentLang === 'en' ? 'Reply in English.' : 'ç”¨ä¸­æ–‡å›å¤ã€‚';
                finalPrompt = `Give a totally random, quirky 30-second relaxation task. ${langPrompt}`;
            }

            let dynamicReward = null;
            try {
                // API è¯·æ±‚ä¸è·³è¿‡æŒ‰é’®è¿›è¡Œèµ›è·‘ (Race)
                dynamicReward = await Promise.race([
                    fetchGeminiWithRetry(finalPrompt),
                    skipPromise
                ]);
            } catch (error) {
                console.error("API error:", error);
            }

            // æ¸…ç†çŠ¶æ€
            clearTimeout(timeoutId);
            skipBtn.style.display = 'none';

            // APIè¿”å›æˆ–è¢«è·³è¿‡ä»¥åï¼Œæ¢å¤æŒ‰é’®å¹¶å¼€å§‹åŠ¨ç”»
            blindbox.innerText = data.btnInsert;
            coin.classList.add('dropping');
            playPopSound();

            setTimeout(() => {
                coin.classList.remove('dropping'); 
                blindbox.classList.add('shaking');

                setTimeout(() => {
                    blindbox.classList.remove('shaking');
                    wrapper.style.display = 'none'; 
                    
                    coinCount++;
                    if(coinCount === 8) {
                        easterEggBtn.style.display = 'inline-block';
                    }
                    
                    petState = 'jumping_aside';
                    const centerX = window.innerWidth / 2;
                    targetX = jarX < centerX ? Math.max(10, centerX - 260) : Math.min(window.innerWidth - 110, centerX + 160);
                    targetY = window.innerHeight / 2 - 80;
                    
                    jumpStartX = jarX;
                    jumpStartY = jarY;
                    jumpStartTime = Date.now();
                    
                    jarBuddy.className = 'side-jumping excited'; 
                    
                    setTimeout(() => {
                        petState = 'busy';
                        const isUpgrade = Math.random() > 0.8; 
                        const currentData = langData[currentLang];

                        if (isUpgrade) {
                            jarBuddy.className = 'spin excited'; 
                            createStarsBurst(); 
                            isPosterShowing = true;
                            currentPosterSVG = generatePosterSVG();
                            rewardContent.innerHTML = currentData.jackpotTitle + currentPosterSVG + currentData.jackpotSub;
                        } else {
                            isPosterShowing = false;
                            jarBuddy.className = 'bounce happy'; 
                            
                            // ä¼˜å…ˆæ˜¾ç¤º Gemini API åŠ¨æ€ç”Ÿæˆçš„å¥–åŠ±
                            if (dynamicReward) {
                                rewardContent.innerHTML = currentData.oraclePrefix + dynamicReward;
                                lastRewardIndex = -1; // æ ‡è®°ä¸ºåŠ¨æ€å¥–åŠ±
                            } else {
                                do { lastRewardIndex = Math.floor(Math.random() * currentData.rewards.length); } 
                                while (lastRewardIndex === -1 && currentData.rewards.length > 1);
                                rewardContent.innerHTML = currentData.rewards[lastRewardIndex];
                            }
                        }
                        
                        rewardCard.style.display = 'block';
                        blindbox.style.pointerEvents = 'auto'; 
                    }, 600);

                }, 500); 
            }, 700); 
        }

        resetBtn.addEventListener('click', () => {
            rewardCard.style.display = 'none';
            wrapper.style.display = 'flex';
            stressInput.value = ''; // é‡ç½®è¾“å…¥æ¡†
            
            jarBuddy.className = ''; 
            petSpeed = 1.5; 
            petState = 'idle';
            isPosterShowing = false;
            pickNewTarget();
        });

        // --- 6. å½©è›‹å¼¹çª—é€»è¾‘ ---
        easterEggBtn.addEventListener('click', () => {
            supportModal.style.display = 'flex';
            easterEggBtn.classList.add('fixed-bottom-right');
        });

        closeModalBtn.addEventListener('click', () => {
            supportModal.style.display = 'none';
        });
    </script>

</body>
</html>