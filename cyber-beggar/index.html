<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30s Everyday Chill</title>
    <style>
        /* --- 1. Base Styling --- */
        body {
            background-color: #222; color: #f4f0ea;
            font-family: 'Courier New', Courier, "PingFang SC", "Microsoft YaHei", "Heiti SC", sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; overflow-x: hidden;
            user-select: none;
        }
        h1 {
            font-size: clamp(1.1rem, 4.5vw, 1.5rem); margin-bottom: 2rem; text-transform: uppercase;
            letter-spacing: 2px; text-align: center; padding: 0 10px; z-index: 5;
            white-space: nowrap;
        }

        /* --- Language Toggle --- */
        #lang-toggle {
            position: absolute; top: 20px; right: 20px;
            background: transparent; border: 2px solid #f4f0ea; color: #f4f0ea;
            padding: 5px 10px; font-family: inherit; font-weight: bold; cursor: pointer;
            z-index: 1000; transition: all 0.2s; text-transform: uppercase;
        }
        #lang-toggle:hover { background: #f4f0ea; color: #111; }

        /* --- 2. THE JAR BUDDY (Bug Buddy) --- */
        #jar-buddy {
            position: fixed; top: 20%; left: 10%; width: 100px; height: 124px;
            z-index: 50; pointer-events: auto; cursor: grab; touch-action: none; 
            transition: transform 0.2s ease-out; 
        }
        #jar-inner { position: relative; width: 100%; height: 100%; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }

        @keyframes neonPulse {
            0% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.4), inset 4px 4px 0 rgba(255, 255, 255, 0.5), inset -4px -4px 0 rgba(255, 140, 0, 0.4); }
            50% { box-shadow: 0 0 30px rgba(255, 165, 0, 0.8), inset 4px 4px 0 rgba(255, 255, 255, 0.7), inset -4px -4px 0 rgba(255, 69, 0, 0.6); }
            100% { box-shadow: 0 0 20px rgba(255, 140, 0, 0.5), inset 4px 4px 0 rgba(255, 255, 255, 0.6), inset -4px -4px 0 rgba(255, 215, 0, 0.5); }
        }

        .jar-lid { position: absolute; top: 0; left: 26px; width: 48px; height: 12px; background-color: #FFD700; border: 4px solid #111; z-index: 4; box-shadow: inset 4px 4px 0 #FFF6A3, inset -4px -4px 0 #DAA520; }
        .jar-lid::after { content: ''; position: absolute; top: 4px; left: 16px; width: 16px; height: 4px; background-color: #111; }
        .jar-neck { position: absolute; top: 16px; left: 34px; width: 32px; height: 16px; background-color: rgba(255, 215, 0, 0.15); border-left: 4px solid #111; border-right: 4px solid #111; z-index: 3; box-shadow: inset 4px 0 0 rgba(255, 255, 255, 0.5); backdrop-filter: blur(4px); }
        .jar-body { position: absolute; top: 32px; left: 10px; width: 80px; height: 72px; border: 4px solid #111; background-color: rgba(255, 215, 0, 0.15); animation: neonPulse 3s infinite alternate ease-in-out; backdrop-filter: blur(4px); z-index: 2; overflow: hidden; }
        
        /* å½©è‰²ç²’å­ç‰¹æ•ˆ */
        .light-particle { position: absolute; width: 4px; height: 4px; border-radius: 0; z-index: 3; animation: floatUp 2s infinite linear; opacity: 0; }
        .light-particle:nth-child(1) { left: 20%; background-color: #FFD700; box-shadow: 0 0 6px #FFD700; animation-delay: 0s; }
        .light-particle:nth-child(2) { left: 50%; background-color: #FFA500; box-shadow: 0 0 6px #FFA500; animation-delay: 0.8s; }
        .light-particle:nth-child(3) { left: 80%; background-color: #FFD700; box-shadow: 0 0 6px #FFD700; animation-delay: 1.5s; }
        @keyframes floatUp { 0% { transform: translateY(60px) scale(0.5); opacity: 0; } 50% { opacity: 0.8; } 100% { transform: translateY(10px) scale(1); opacity: 0; } }

        /* 8-Bit è¡¨æƒ…åº“ */
        .pixel-face { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); width: 44px; height: 28px; display: flex; flex-direction: column; align-items: center; z-index: 5; }
        .eyes { display: flex; justify-content: space-between; width: 100%; margin-bottom: 4px; }
        .eye { width: 8px; height: 8px; background-color: #111; }
        .mouth { width: 16px; height: 8px; background-color: transparent; border-bottom: 4px solid #111; border-left: 4px solid #111; border-right: 4px solid #111; }
        
        #jar-buddy.happy .eye { height: 4px; margin-top: 4px; background-color: transparent; border-top: 4px solid #111; border-left: 4px solid #111; border-right: 4px solid #111; }
        #jar-buddy.happy .mouth { width: 24px; height: 12px; background-color: #111; border: none; }
        
        #jar-buddy.excited .eye { width: 8px; height: 12px; }
        #jar-buddy.excited .mouth { width: 12px; height: 12px; background-color: #111; border: none; position: relative; overflow: hidden; margin-top: 2px; }
        #jar-buddy.excited .mouth::after { content: ''; position: absolute; bottom: 0; left: 2px; width: 8px; height: 4px; background-color: #FF6B6B; }

        #jar-buddy.boring .eye { height: 4px; margin-top: 4px; }
        #jar-buddy.boring .mouth { width: 12px; height: 4px; border: none; background-color: #111; }

        #jar-buddy.wicked .eye { width: 12px; height: 4px; margin-top: 4px; }
        #jar-buddy.wicked .eye:first-child { transform: rotate(20deg); }
        #jar-buddy.wicked .eye:last-child { transform: rotate(-20deg); }
        #jar-buddy.wicked .mouth { width: 24px; height: 4px; background-color: transparent; border-top: 4px solid #111; border-left: 4px solid #111; border-right: 4px solid #111; border-bottom: none; margin-top: 4px;}

        #jar-buddy.kissing .eye { height: 4px; margin-top: 4px; }
        #jar-buddy.kissing .mouth { width: 8px; height: 8px; border: 4px solid #111; border-radius: 50%; background: #FF6B6B; }
        
        /* å››è‚¢ä¸åŠ¨ä½œ */
        .limb { position: absolute; background-color: #111; z-index: 1; }
        .arm { width: 24px; height: 4px; top: 60px; } 
        .left-arm { left: -14px; transform-origin: right center; transform: rotate(25deg); animation: idleArmL 2.5s infinite ease-in-out; }
        .right-arm { right: -14px; transform-origin: left center; transform: rotate(-25deg); animation: idleArmR 2.5s infinite ease-in-out; }
        @keyframes idleArmL { 0%, 100% { transform: rotate(25deg); } 50% { transform: rotate(45deg); } }
        @keyframes idleArmR { 0%, 100% { transform: rotate(-25deg); } 50% { transform: rotate(-45deg); } }
        
        .leg { width: 4px; height: 16px; top: 112px; transform-origin: top center; }
        .leg::after { content: ''; position: absolute; bottom: 0; width: 12px; height: 4px; background-color: #111; } 
        .left-leg { left: 30px; transform: rotate(15deg); }
        .right-leg { right: 30px; transform: rotate(-15deg); }

        /* åŠ¨ç”»çŠ¶æ€ */
        #jar-buddy.walking #jar-inner { animation: walkBob 0.3s infinite alternate ease-in-out; } 
        #jar-buddy.walking .left-leg { animation: walkLeft 0.4s infinite linear; }
        #jar-buddy.walking .right-leg { animation: walkRight 0.4s infinite linear; }
        @keyframes walkLeft { 0%, 100% { transform: rotate(15deg); } 50% { transform: rotate(-30deg); } }
        @keyframes walkRight { 0%, 100% { transform: rotate(-15deg); } 50% { transform: rotate(30deg); } }
        @keyframes walkBob { 0% { transform: translateY(0px); } 100% { transform: translateY(-4px); } }
        
        /* ä¾§å‘æ—‹è½¬è·³è·ƒ */
        #jar-buddy.side-jumping #jar-inner { animation: sideJumpSpin 0.6s ease-in-out forwards; }
        @keyframes sideJumpSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ä¸­å¥–æ—‹è½¬ */
        #jar-buddy.jackpot-spin #jar-inner { animation: jackpotSpin 0.8s ease-in-out forwards; }
        @keyframes jackpotSpin { 0% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-50px) rotate(180deg); } 100% { transform: translateY(0) rotate(360deg); } }

        #jar-buddy.dragged { cursor: grabbing; z-index: 2000; }
        #jar-buddy.dragged #jar-inner { animation: dragWiggle 0.1s infinite alternate linear; }
        @keyframes dragWiggle { 0% { transform: rotate(-5deg); } 100% { transform: rotate(5deg); } }

        .zzz { position: absolute; top: -20px; right: -20px; color: #f4f0ea; font-weight: bold; font-size: 16px; opacity: 0; pointer-events: none; }
        #jar-buddy.snoozing .zzz { animation: zzzFloat 3s ease-in-out infinite; }
        @keyframes zzzFloat { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 1; } 100% { opacity: 0; transform: translateY(-24px); } }

        /* --- 3. Interaction Components --- */
        #interaction-wrapper { display: flex; flex-direction: column; align-items: center; z-index: 10; width: 100%; max-width: 400px; }
        #stress-input {
            background-color: #111; border: 4px solid #111; box-shadow: 4px 4px 0 #FFD700;
            color: #f4f0ea; padding: 12px 15px; font-family: inherit; font-size: 1rem; font-weight: bold;
            width: 90%; margin-bottom: 20px; outline: none; text-align: center;
            transition: all 0.2s; box-sizing: border-box;
        }
        #blindbox {
            position: relative; background-color: #ffeb3b; border: 4px solid #111; box-shadow: 8px 8px 0px #111;
            padding: 20px 40px; font-size: 1.2rem; font-weight: bold; font-family: inherit; cursor: pointer;
            text-transform: uppercase; width: 100%; outline: none; color: #111; transition: all 0.1s;
        }
        #blindbox:active { transform: translate(2px, 2px); box-shadow: 6px 6px 0px #111; }
        #skip-btn { display: none; margin-top: 15px; background: #FF6B6B; border: 4px solid #111; padding: 8px 20px; font-weight: bold; cursor: pointer; }

        /* ç¡¬å¸æ‰è½åŠ¨ç”» */
        #coin {
            position: absolute; top: -60px; width: 36px; height: 36px; background-color: #FFD700;
            border: 4px solid #111; display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 20px; box-shadow: inset -4px -4px 0 #DAA520;
            opacity: 0; pointer-events: none; z-index: 11; color: #111;
        }
        .dropping { animation: dropCoin 0.7s cubic-bezier(0.5, 0, 0.5, 1) forwards; }
        @keyframes dropCoin { 
            0% { opacity: 1; top: -60px; transform: rotate(0deg); } 
            80% { opacity: 1; top: 15px; transform: rotate(360deg); } 
            100% { opacity: 0; top: 25px; } 
        }

        /* æ˜Ÿæ˜Ÿçˆ†å‘ */
        .dynamic-star {
            position: fixed; width: 12px; height: 12px; z-index: 9999; 
            pointer-events: none; opacity: 1; border: 4px solid #111; 
        }
        .dynamic-star.burst { animation: starBurst 1s ease-out forwards; }
        @keyframes starBurst {
            0% { transform: translate(0,0) rotate(0deg) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) rotate(360deg) scale(1.5); opacity: 0; }
        }

        /* --- 4. Reward Card & Poster --- */
        #reward-card {
            display: none; background-color: #333; border: 4px solid #111; box-shadow: 8px 8px 0px #111; padding: 25px;
            width: 85%; max-width: 400px; text-align: center; animation: popIn 0.3s ease forwards;
            line-height: 1.6; position: relative;
        }
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .poster-svg { width: 100%; height: auto; border: 4px solid #111; margin-bottom: 15px; background: #222; }

        /* --- 5. Footer Widgets & Modals --- */
        .cyber-link { color: #FFD700; text-decoration: none; border-bottom: 2px dashed #FFD700; }
        .cyber-link:hover { color: #FFF6A3; border-bottom-style: solid; }
        #bottom-widgets { position: fixed; bottom: 20px; left: 20px; display: flex; align-items: center; gap: 10px; z-index: 900; }
        #visit-counter img { border: 2px solid #111; box-shadow: 2px 2px 0 #FFD700; height: 24px; vertical-align: middle; }
        #settings-btn { background: #111; border: 2px solid #FFD700; color: #FFD700; cursor: pointer; width: 32px; height: 32px; box-shadow: 2px 2px 0 #FFD700; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
        .modal-box { background: #222; border: 4px solid #FFD700; padding: 30px; text-align: center; max-width: 85%; width: 360px; box-shadow: 8px 8px 0 #111; }
        
        .modal-btn { 
            background: #FFD700; border: 4px solid #111; color: #111; padding: 8px 20px; 
            font-weight: bold; cursor: pointer; text-transform: uppercase; margin-top: 15px;
            font-family: inherit; letter-spacing: 2px;
        }
        
        #easter-egg-btn { 
            display: none; margin-top: 20px; border: 2px dashed #ccc; background:none; color:#ccc; padding:10px; cursor:pointer; 
            font-family: inherit; text-transform: uppercase; letter-spacing: 2px; font-weight: bold;
        }

        #reset-btn {
            margin-top: 20px; padding: 10px; background: transparent; border: 2px solid #fff; color: #fff; cursor: pointer;
            font-family: inherit; text-transform: uppercase; letter-spacing: 2px; font-weight: bold;
        }
    </style>
</head>
<body>

    <button id="lang-toggle">ä¸­æ–‡</button>
    <h1 id="site-title">[ ğŸ•¹ï¸ Insert Coin for 30s Chill â˜• ]</h1>

    <div id="jar-buddy">
        <div id="jar-inner">
            <div class="zzz">Zzz...</div>
            <div class="jar-lid"></div>
            <div class="jar-neck"></div> 
            <div class="jar-body">
                <div class="light-particle"></div><div class="light-particle"></div><div class="light-particle"></div>
                <div class="pixel-face">
                    <div class="eyes"><div class="eye"></div><div class="eye"></div></div>
                    <div class="mouth"></div>
                </div>
                <div class="contents">
                    <div class="pixel-coin"></div><div class="pixel-coin"></div><div class="pixel-coin"></div>
                </div>
            </div>
            <div class="limb arm left-arm"></div><div class="limb arm right-arm"></div>
            <div class="limb leg left-leg"></div><div class="limb leg right-leg"></div>
        </div>
    </div>

    <div id="interaction-wrapper">
        <input type="text" id="stress-input" placeholder="What's on your mind? (Optional)">
        <div id="interaction-container" style="position:relative; width:300px; height:100px; display:flex; justify-content:center;">
            <div id="coin">$</div>
            <button id="blindbox">ğŸ INSERT COIN ğŸ</button>
        </div>
        <button id="skip-btn">I want it now!</button>
    </div>

    <div id="reward-card">
        <div id="reward-content"></div>
        <button id="reset-btn">Toss another?</button>
    </div>

    <button id="easter-egg-btn">find it interesting?</button>

    <div id="support-modal" class="modal-overlay">
        <div class="modal-box">
            <div id="modal-text">âœ¨ xoxo! please insert a real coin for me >u< âœ¨</div>
            <br>
            <div style="font-size: 0.9rem;">
                <a href="https://yishuangguo.github.io/yishuangguo/" target="_blank" class="cyber-link">ğŸŒ My GitHub</a>
                <br><br>
                <a href="mailto:guoyishuang.work@gmail.com" class="cyber-link">âœ‰ï¸ guoyishuang.work@gmail.com</a>
            </div>
            <br>
            <button class="modal-btn" onclick="document.getElementById('support-modal').style.display='none'">Close</button>
        </div>
    </div>

    <div id="api-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 style="margin-top:0; color:#FFD700;">âš™ï¸ Setup API Key</h3>
            <input type="password" id="api-input" placeholder="Paste Gemini API Key here..." style="width:90%; padding:8px; background:#111; color:#fff; border:2px solid #666;">
            <br><br>
            <button class="modal-btn" id="save-api-btn">Save</button>
            <button class="modal-btn" style="background:#444; color:#fff; border-color:#222; letter-spacing:0;" onclick="document.getElementById('api-modal').style.display='none'">Cancel</button>
        </div>
    </div>

    <div id="bottom-widgets">
        <div id="visit-counter" title="Total Visitors">
            <img src="https://api.visitorbadge.io/api/visitors?path=https%3A%2F%2Fyishuangguo.github.io%2Fyishuangguo%2F30s-chill&label=VISITS&labelColor=%23222&countColor=%23FFD700&style=flat-square" alt="VISITS">
        </div>
        <button id="settings-btn" title="Setup API Key">âš™ï¸</button>
    </div>

    <script>
        // ==========================================
        // ğŸ”‘ API CONFIGURATION
        // ==========================================
        const hardcodedApiKey = "AIzaSyBGbuzspmaFbWdHW4oBDai_4eFUfU-mGdY"; 
        function getActiveApiKey() { return localStorage.getItem('custom_gemini_api_key') || hardcodedApiKey; }

        // --- 1. Pool Data ---
        const langData = {
            en: { 
                title: "[ ğŸ•¹ï¸ Insert Coin for 30s Chill â˜• ]", 
                btnInsert: "ğŸ INSERT COIN ğŸ", 
                consulting: "âœ¨ CONSULTING ORACLE... âœ¨", 
                oraclePrefix: "âœ¨ <b>Oracle Says:</b> ",
                jackpotTitle: "<b>âœ¨ JACKPOT BONUS! âœ¨</b><br>You got a special buddy poster.<br>",
                jackpotSub: "<small>Take a 30s visual break.</small>",
                rewards: [
                    "ğŸ§˜ <b>30s Chill:</b> Stare at the wall and blink manually 10 times. Go.",
                    "ğŸ’§ <b>Hydration Check:</b> Take three sips of water. Now.",
                    "ğŸŒ¬ï¸ <b>Breathe:</b> Inhale 4s, Hold 4s, Exhale 4s. Repeat.",
                    "ğŸ‘€ <b>Visual Diet:</b> Find a 90-degree angle in your room. Nice.",
                    "ğŸ¨ <b>Daily Hex:</b> #FF7F50 Coral. Soft but energetic.",
                    "ğŸ«‚ <b>High Five:</b> Give yourself a literal high-five. You deserve it.",
                    "ğŸ¥  <b>Anti-Fortune:</b> Your posture is mediocre. Sit up straight.",
                    "ğŸª™ <b>Cyber-Junk:</b> You found a pristine ASCII frog: (o_o)",
                    "ğŸŸ <b>Slacker Drill:</b> Press `Alt + Tab` once to maintain switching muscle memory.",
                    "ğŸ”‹ <b>Low Battery:</b> You're at 20%. Grab a snack for physical recharge.",
                    "ğŸ‘ <b>Thumb Gratitude:</b> Stare at your thumb for 10s. It worked hard today.",
                    "ğŸ± <b>Cat Mode:</b> Pretend you are a cat and stretch. Meow optionally.",
                    "ğŸ‘£ <b>Toe Awareness:</b> Wiggle your toes until they feel like individual entities.",
                    "ğŸ–ï¸ <b>Friendly Wave:</b> Give a tiny wave to a nearby object.",
                    "ğŸ˜ <b>Mental Art:</b> Close eyes and visualize a purple elephant wearing sunglasses.",
                    "ğŸ•µï¸ <b>Spy Code:</b> Tap your desk in a rhythm like a secret spy code.",
                    "ğŸ‘„ <b>Jaw Release:</b> Check if you are clenching your jaw. Release it now.",
                    "ğŸ¡ <b>Wheee!:</b> Spin your chair exactly 360 degrees.",
                    "ğŸ§± <b>Boring Zen:</b> Find the most boring thing nearby and appreciate it for 5s.",
                    "ğŸŒ¬ï¸ <b>Oxygen Smile:</b> Smile at the air. It is full of oxygen for you.",
                    "ğŸ§™ <b>Tech Wizard:</b> Adjust screen brightness by 1% then put it back. Wizardry.",
                    "ğŸµ <b>Whisper Song:</b> Sing one line of your favorite song in a whisper.",
                    "ğŸ‘… <b>Tongue Gym:</b> Try to touch your nose with your tongue. Fail gracefully.",
                    "ğŸ‹ï¸ <b>Squat Master:</b> Stand up, sit down. Squat count: 1. Olympic level.",
                    "ğŸ  <b>Ceiling Zen:</b> Look at the ceiling and wonder why it's there.",
                    "ğŸ¤ª <b>Reflection Face:</b> Make a silly face at yourself in your phone's black screen.",
                    "ğŸŒ½ <b>Pun Drill:</b> Think of a pun so bad it makes you groan.",
                    "ğŸ§¥ <b>Shoulder Check:</b> Check left shoulder. Then right. Both still there? Good.",
                    "ğŸ‘¨â€ğŸš€ <b>Zero Gravity:</b> Imagine you are floating in space. No gravity, just chill.",
                    "ğŸ¤¡ <b>Sarcastic Cheer:</b> Tell yourself 'You're doing great' in a sarcastic voice."
                ],
                btnEaster: "find it interesting?", inputPlaceholder: "What's on your mind? (Optional)", btnReset: "Toss another?", btnSkip: "I want it now!"
            },
            zh: { 
                title: "[ ğŸ•¹ï¸ æŠ•å¸è·å–30ç§’æ”¾æ¾ â˜• ]", 
                btnInsert: "ğŸ æŠ•å¸ ğŸ", 
                consulting: "âœ¨ ç¥æ˜ç®—å‘½ä¸­... âœ¨", 
                oraclePrefix: "âœ¨ <b>èµ›åšç¥è°•ï¼š</b> ",
                jackpotTitle: "<b>âœ¨ ç»ˆæå¤§å¥–ï¼ âœ¨</b><br>ä½ è·å¾—äº†ä¸€å¼ ä¸“å±å°ç½å¤´æµ·æŠ¥ã€‚<br>",
                jackpotSub: "<small>äº«å—30ç§’çš„è§†è§‰æ”¾æ¾å§ã€‚</small>",
                rewards: [
                    "ğŸ§˜ <b>30ç§’æ”¾æ¾ï¼š</b>ç›¯ç€å¢™å£æ‰‹åŠ¨çœ¨çœ¼10æ¬¡ã€‚å¼€å§‹ã€‚",
                    "ğŸ’§ <b>è¡¥å……æ°´åˆ†ï¼š</b>å–ä¸‰å£æ°´ã€‚ç«‹åˆ»ã€‚",
                    "ğŸŒ¬ï¸ <b>æ·±å‘¼å¸ï¼š</b>å¸æ°”4ç§’ï¼Œæ†‹æ°”4ç§’ï¼Œå‘¼æ°”4ç§’ã€‚å†æ¥ä¸€æ¬¡ã€‚",
                    "ğŸ‘€ <b>ç»“æ„æ¬£èµï¼š</b>çœ‹çœ‹æˆ¿é—´é‡Œçš„90åº¦ç›´è§’ã€‚å¤šå®Œç¾ã€‚",
                    "ğŸ¨ <b>ä»Šæ—¥è‰²å½©ï¼š</b>#FF7F50 çŠç‘šè‰²ã€‚æ¸©æŸ”åˆå……æ»¡åŠ›é‡ã€‚",
                    "ğŸ«‚ <b>å‡»æŒï¼š</b>ç»™è‡ªå·±ä¸€ä¸ªå­—é¢æ„ä¹‰ä¸Šçš„å‡»æŒã€‚ä½ å€¼å¾—ã€‚",
                    "ğŸ¥  <b>åå¿ƒçµé¸¡æ±¤ï¼š</b>ä½ ç°åœ¨çš„åå§¿å¾ˆçƒ‚ã€‚åç›´äº†ã€‚",
                    "ğŸª™ <b>èµ›åšç ´çƒ‚ï¼š</b>ä½ æ¡åˆ°äº†ä¸€åªå®Œå¥½æ— æŸçš„ASCIIé’è›™: (o_o)",
                    "ğŸŸ <b>æ‘¸é±¼æ¼”ç»ƒï¼š</b>è¿…é€ŸæŒ‰ä¸‹ `Alt + Tab` ä¸€æ¬¡ï¼Œä¿æŒæµç•…çš„åˆ‡å±è‚Œè‚‰è®°å¿†ã€‚",
                    "ğŸ”‹ <b>ç‰©ç†å……ç”µï¼š</b>ä½ çš„èƒ½é‡å·²ä¸è¶³20%ï¼Œè¯·é©¬ä¸Šåƒç‚¹é›¶é£Ÿã€‚",
                    "ğŸ‘ <b>æ„Ÿè°¢æ‹‡æŒ‡ï¼š</b>ç›¯ç€å¤§æ‹‡æŒ‡çœ‹10ç§’ã€‚å®ƒä»Šå¤©ä¸ºä½ è¾›è‹¦äº†ã€‚",
                    "ğŸ± <b>çŒ«ä¹‹ä¼¸å±•ï¼š</b>å‡è£…è‡ªå·±æ˜¯ä¸€åªçŒ«å¹¶ä¼¸ä¸ªæ‡’è…°ã€‚å¯ä»¥å°å£°å–µä¸€ä¸‹ã€‚",
                    "ğŸ‘£ <b>è„šè¶¾è§‰é†’ï¼š</b>åŠ¨åŠ¨è„šè¶¾ï¼Œç›´åˆ°æ„Ÿè§‰åˆ°å®ƒä»¬æ˜¯ç‹¬ç«‹çš„ä¸ªä½“ã€‚",
                    "ğŸ–ï¸ <b>å‹è°Šä¹‹æ‰‹ï¼š</b>å‘ç¦»ä½ æœ€è¿‘çš„ä¸€ä¸ªç‰©ä½“æ‰“ä¸ªå°æ‹›å‘¼ã€‚",
                    "ğŸ˜ <b>è„‘å†…è‰ºæœ¯ï¼š</b>é—­ä¸Šçœ¼ï¼Œæƒ³è±¡ä¸€åªæˆ´ç€å¢¨é•œçš„ç´«è‰²å¤§è±¡ã€‚",
                    "ğŸ•µï¸ <b>ç‰¹å·¥ç”µç ï¼š</b>åƒå‘æ‘©æ–¯ç”µç ä¸€æ ·æœ‰èŠ‚å¥åœ°æ•²æ•²æ¡Œå­ã€‚",
                    "ğŸ‘„ <b>å’¬è‚Œæ”¾æ¾ï¼š</b>æ£€æŸ¥ä¸‹ä½ æ˜¯ä¸æ˜¯åœ¨å’¬ç´§ç‰™å…³ï¼Ÿæ¾å¼€å®ƒã€‚",
                    "ğŸ¡ <b>èŠœæ¹–ï¼ï¼š</b>æŠŠæ¤…å­è½¬ä¸ª 360 åº¦ã€‚",
                    "ğŸ§± <b>æ— èŠä¹‹ç¦…ï¼š</b>æ‰¾æ‰¾æˆ¿é—´é‡Œæœ€æ— èŠçš„ä¸œè¥¿ï¼Œæ„Ÿè°¢å®ƒå­˜åœ¨äº†5ç§’ã€‚",
                    "ğŸŒ¬ï¸ <b>æ°§æ°”ä¹‹å»ï¼š</b>å¯¹ç€ç©ºæ°”ç¬‘ä¸€ä¸‹ï¼Œå®ƒå…¨æ˜¯ä¸ºä½ å‡†å¤‡çš„æ°§æ°”ã€‚",
                    "ğŸ§™ <b>ç§‘æŠ€å¤§å¸ˆï¼š</b>æŠŠå±å¹•äº®åº¦è°ƒé«˜1%å†è°ƒå›å»ã€‚å¤§å¸ˆçº§åˆ«çš„æ“ä½œã€‚",
                    "ğŸµ <b>ä½è¯­æ­Œè€…ï¼š</b>å°å£°å“¼å”±ä¸€å¥ä½ æœ€å–œæ¬¢çš„æ­Œã€‚",
                    "ğŸ‘… <b>èˆŒå¤´ä½“æ“ï¼š</b>å°è¯•ç”¨èˆŒå¤´èˆ”åˆ°é¼»å­ã€‚ä¼˜é›…åœ°å¤±è´¥ä¹Ÿæ²¡å…³ç³»ã€‚",
                    "ğŸ‹ï¸ <b>æ·±è¹²å¤§å¸ˆï¼š</b>èµ·ç«‹ï¼Œåä¸‹ã€‚æ·±è¹²è®¡æ•°ï¼š1ã€‚å¥¥è¿é€‰æ‰‹çº§åˆ«ã€‚",
                    "ğŸ  <b>ä»°æœ›è‹ç©¹ï¼š</b>æŠ¬å¤´çœ‹çœ‹å¤©èŠ±æ¿ï¼Œæ€è€ƒå®ƒå­˜åœ¨çš„æ„ä¹‰ã€‚",
                    "ğŸ¤ª <b>é•œä¸­é¢œè‰ºï¼š</b>å¯¹ç€æ‰‹æœºé»‘å±çš„åå…‰åšä¸ªé¬¼è„¸ã€‚",
                    "ğŸŒ½ <b>æå¯’æŒ‘æˆ˜ï¼š</b>æƒ³ä¸€ä¸ªå†·åˆ°æ‰æ¸£çš„å†·ç¬‘è¯ï¼Œå†·æ­»è‡ªå·±ã€‚",
                    "ğŸ§¥ <b>åŒè‚©è‡ªæ£€ï¼š</b>æ£€æŸ¥å·¦è‚©ï¼Œå†æ£€æŸ¥å³è‚©ã€‚éƒ½è¿˜åœ¨ï¼Ÿå¾ˆå¥½ã€‚",
                    "ğŸ‘¨â€ğŸš€ <b>é›¶é‡åŠ›ï¼š</b>æƒ³è±¡ä½ æ­£åœ¨å¤ªç©ºæ¼‚æµ®ã€‚æ²¡æœ‰é‡åŠ›ï¼Œåªæœ‰æ”¾æ¾ã€‚",
                    "ğŸ¤¡ <b>é«˜çº§é˜´é˜³ï¼š</b>ç”¨æå…¶è®½åˆºçš„è¯­æ°”å¯¹è‡ªå·±è¯´ï¼šâ€˜ä½ åšå¾—çœŸæ£’â€™ã€‚"
                ],
                btnEaster: "è§‰å¾—æœ‰è¶£å—ï¼Ÿ", inputPlaceholder: "æœ‰ä»€ä¹ˆçƒ¦å¿ƒäº‹ï¼Ÿ(é€‰å¡«)", btnReset: "å†æ¥ä¸€æ¬¡ï¼Ÿ", btnSkip: "æˆ‘ç°åœ¨å°±è¦ï¼"
            }
        };

        const palettes = [
            ['#FFD700', '#FF6B6B', '#4ECDC4', '#1A535C'], ['#E0C097', '#B85C38', '#5C3D2E', '#2D2424'], 
            ['#A8E6CF', '#DCEDC1', '#FFD3B6', '#FFAAA5'], ['#111111', '#333333', '#555555', '#FFD700']  
        ];

        let currentLang = 'en';
        let coinCount = 0;
        const blindbox = document.getElementById('blindbox');
        const stressInput = document.getElementById('stress-input');
        const jarBuddy = document.getElementById('jar-buddy');
        const rewardCard = document.getElementById('reward-card');
        const rewardContent = document.getElementById('reward-content');
        const skipBtn = document.getElementById('skip-btn');
        const wrapper = document.getElementById('interaction-wrapper');
        const coin = document.getElementById('coin');
        const easterEggBtn = document.getElementById('easter-egg-btn');

        // --- 2. Pet Engine ---
        let jarX = window.innerWidth / 2 - 50, jarY = 150;
        let targetX = jarX, targetY = jarY;
        let jumpStartX = 0, jumpStartY = 0, jumpStartTime = 0;
        let petState = 'idle'; 
        let isDragging = false;
        let petSpeed = 1.5;

        function pickNewTarget() {
            if (petState !== 'idle' && petState !== 'walking') return;
            targetX = Math.random() * (window.innerWidth - 120) + 10;
            targetY = Math.random() * (window.innerHeight - 300) + 50;
            petState = 'walking';
            jarBuddy.className = 'walking';
            jarBuddy.style.transform = targetX < jarX ? 'scaleX(-1)' : 'scaleX(1)';
        }

        function updatePet() {
            if (petState === 'dragged') {
                jarBuddy.style.left = jarX + 'px';
                jarBuddy.style.top = jarY + 'px';
            }
            else if (petState === 'jumping_aside') {
                const p = (Date.now() - jumpStartTime) / 600;
                if (p < 1) {
                    jarX = jumpStartX + (targetX - jumpStartX) * p;
                    jarY = jumpStartY + (targetY - jumpStartY) * p - Math.sin(p * Math.PI) * 100;
                } else { jarX = targetX; jarY = targetY; }
            }
            else if (!isDragging && (petState === 'walking' || petState === 'busy')) {
                const dx = targetX - jarX, dy = targetY - jarY;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < 10) {
                    if (petState === 'walking') {
                        const r = Math.random();
                        if (r < 0.15) { petState = 'snoozing'; jarBuddy.className = 'snoozing boring'; }
                        else if (r < 0.3) { petState = 'happy'; jarBuddy.className = 'happy'; }
                        else if (r < 0.45) { petState = 'wicked'; jarBuddy.className = 'wicked'; }
                        else if (r < 0.6) { petState = 'kissing'; jarBuddy.className = 'kissing'; }
                        else { petState = 'idle'; jarBuddy.className = ''; }
                        setTimeout(() => { if(!isDragging && petState !== 'busy' && petState !== 'jumping_aside') pickNewTarget(); }, 3000);
                    }
                } else {
                    jarX += (dx / dist) * petSpeed;
                    jarY += (dy / dist) * petSpeed;
                }
            }
            jarBuddy.style.left = jarX + 'px';
            jarBuddy.style.top = jarY + 'px';
            requestAnimationFrame(updatePet);
        }

        // --- 3. Effects Engine ---
        function playPopSound() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode); gainNode.connect(audioCtx.destination);
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(400, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                oscillator.start(); oscillator.stop(audioCtx.currentTime + 0.1);
            } catch(e) {}
        }

        function createStarsBurst() {
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            const colors = ['#FFD700', '#FFA500', '#FF8C00', '#FFF6A3']; 
            for(let i=0; i < 24; i++) {
                const star = document.createElement('div');
                star.className = 'dynamic-star';
                star.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                star.style.left = centerX + 'px'; star.style.top = centerY + 'px';
                const angle = Math.random() * Math.PI * 2;
                const dist = 100 + Math.random() * 200; 
                star.style.setProperty('--dx', (Math.cos(angle) * dist) + 'px');
                star.style.setProperty('--dy', (Math.sin(angle) * dist) + 'px');
                document.body.appendChild(star);
                requestAnimationFrame(() => star.classList.add('burst'));
                setTimeout(() => star.remove(), 1000);
            }
        }

        function generatePosterSVG() {
            const p = palettes[Math.floor(Math.random() * palettes.length)];
            const bg = p[0], ac1 = p[1], ac2 = p[2], ac3 = p[3];
            return `<svg class="poster-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="background-color: ${bg}22">
                <rect x="15" y="15" width="20" height="20" fill="${ac1}" opacity="0.6"/>
                <rect x="65" y="65" width="25" height="15" fill="${ac2}" opacity="0.6"/>
                <rect x="70" y="20" width="10" height="10" fill="${ac3}" opacity="0.8"/>
                <g transform="translate(30, 25)">
                    <rect x="8" y="0" width="24" height="6" fill="#FFD700" stroke="#111" stroke-width="2"/>
                    <rect x="0" y="16" width="40" height="36" fill="rgba(255,215,0,0.5)" stroke="#111" stroke-width="2"/>
                    <path d="M 12 28 Q 14 26 16 28" fill="none" stroke="#111" stroke-width="2"/>
                    <path d="M 24 28 Q 26 26 28 28" fill="none" stroke="#111" stroke-width="2"/>
                    <rect x="14" y="34" width="12" height="4" fill="#111"/>
                </g>
            </svg>`;
        }

        // --- 4. API & Interaction ---
        async function fetchGemini(prompt) {
            const key = getActiveApiKey();
            if (!key) return null;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: "Provide a sassy, short 30-second relaxation task. Max 2 sentences. Use emojis." }] }
                    })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (e) { return null; }
        }

        blindbox.addEventListener('click', async () => {
            const stressText = stressInput.value.trim();
            const data = langData[currentLang];
            let dynamicReward = null;

            playPopSound();
            coin.classList.add('dropping');
            
            // Move Buddy to Box
            const boxRect = blindbox.getBoundingClientRect();
            targetX = boxRect.left - 20; targetY = boxRect.top - 80;
            petState = 'busy'; petSpeed = 8; jarBuddy.className = 'walking excited';

            if (stressText) {
                blindbox.innerText = data.consulting;
                skipBtn.style.display = 'block';
                dynamicReward = await fetchGemini(stressText);
                skipBtn.style.display = 'none';
            }

            setTimeout(() => {
                coin.classList.remove('dropping');
                
                // ä¾§ç¿»åŠ¨ä½œ
                petState = 'jumping_aside';
                const centerX = window.innerWidth / 2;
                targetX = jarX < centerX ? centerX - 260 : centerX + 160;
                targetY = window.innerHeight / 2 - 80;
                jumpStartX = jarX; jumpStartY = jarY; jumpStartTime = Date.now();
                jarBuddy.className = 'side-jumping excited';

                setTimeout(() => {
                    const isJackpot = Math.random() < 0.2; 
                    if (isJackpot) {
                        petState = 'busy'; jarBuddy.className = 'jackpot-spin excited';
                        createStarsBurst();
                        rewardContent.innerHTML = data.jackpotTitle + generatePosterSVG() + data.jackpotSub;
                    } else {
                        petState = 'happy'; jarBuddy.className = 'happy';
                        rewardContent.innerHTML = dynamicReward ? (data.oraclePrefix + dynamicReward) : data.rewards[Math.floor(Math.random()*data.rewards.length)];
                    }

                    rewardCard.style.display = 'block';
                    wrapper.style.display = 'none';
                    blindbox.innerText = data.btnInsert;
                    coinCount++;
                    if (coinCount >= 5) easterEggBtn.style.display = 'block';
                }, 600);
            }, 800);
        });

        // --- 5. UI Logic ---
        document.getElementById('reset-btn').onclick = () => {
            rewardCard.style.display = 'none'; wrapper.style.display = 'flex';
            stressInput.value = ''; jarBuddy.className = '';
            petState = 'idle'; petSpeed = 1.5; pickNewTarget();
        };

        document.getElementById('lang-toggle').onclick = () => {
            currentLang = currentLang === 'en' ? 'zh' : 'en';
            const data = langData[currentLang];
            document.getElementById('lang-toggle').innerText = currentLang === 'en' ? 'ä¸­æ–‡' : 'EN';
            document.getElementById('site-title').innerText = data.title;
            blindbox.innerText = data.btnInsert;
            stressInput.placeholder = data.inputPlaceholder;
            document.getElementById('reset-btn').innerText = data.btnReset;
            document.getElementById('easter-egg-btn').innerText = data.btnEaster;
            skipBtn.innerText = data.btnSkip;
        };

        jarBuddy.onmousedown = (e) => {
            if (petState === 'jumping_aside' || petState === 'busy') return;
            isDragging = true; petState = 'dragged'; jarBuddy.className = 'dragged excited';
            const rect = jarBuddy.getBoundingClientRect();
            let offsetX = e.clientX - rect.left, offsetY = e.clientY - rect.top;
            const move = (me) => { jarX = me.clientX - offsetX; jarY = me.clientY - offsetY; };
            const up = () => { isDragging = false; petState = 'idle'; pickNewTarget(); window.removeEventListener('mousemove', move); window.removeEventListener('mouseup', up); };
            window.addEventListener('mousemove', move); window.addEventListener('mouseup', up);
        };

        document.getElementById('save-api-btn').onclick = () => {
            const val = document.getElementById('api-input').value.trim();
            if (val) localStorage.setItem('custom_gemini_api_key', val);
            else localStorage.removeItem('custom_gemini_api_key');
            document.getElementById('api-modal').style.display = 'none';
        };

        document.getElementById('settings-btn').onclick = () => document.getElementById('api-modal').style.display = 'flex';
        document.getElementById('easter-egg-btn').onclick = () => document.getElementById('support-modal').style.display = 'flex';

        window.onload = () => { updatePet(); setTimeout(pickNewTarget, 1000); };
    </script>
</body>
</html>
